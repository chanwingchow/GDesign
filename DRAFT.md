# 商品真实化的Roguelike游戏系统设计与开发

## 目录

```
1 绪论
    1.1 研究背景与意义
    1.2 国内外研究现状
    1.3 本文主要创新
    1.4 相关技术
2 游戏设计
    2.1 游戏核心机制
    2.2 经济系统
    2.3 游戏世界与关卡
    2.4 生物设计
    2.5 用户界面
    2.6 音效与视觉表现
3 后端设计
    3.1 数据库设计
    3.2 JWT 认证
    3.3 商品网络爬虫
    3.4 推荐算法
    3.5 订单
4 总结与展望
    4.1 研究成功总结
    4.2 不足与改进方向
    4.3 未来研究方向
```

## 1 绪论

### 1.1 研究背景与意义

近年来，中国游戏行业蓬勃发展，涌现出许多备受瞩目的作品。其中，《黑神话：悟空》作为一款由国内团队开发的动作角色扮演游戏，凭借其高水准的画面表现、精妙的战斗设计以及对传统文化的创新演绎，成为国产游戏的标杆。该游戏不仅在国内广受关注，在国际游戏市场上也赢得了高度评价，彰显出中国游戏行业在技术、创新和文化输出方面的显著进步。

目光来到电商行业，各大电商平台为增强用户粘性，引入了各种小游戏。这些游戏的类型多以养成、消除、抽奖等为主，游戏难度较低，适合各类用户。除了主要玩法外，游戏的其他内容基本上都是服务于营销，例如，有的游戏中会要求用户浏览、购买商品以获取游戏道具。现如今，诸如小红书、抖音等社交、短视频平台接入了电商购物功能，以进一步提升用户留存。反观游戏行业，很少有产品结合真实商品售卖，将电商元素融入游戏中。

Roguelike是一种以高难度、随机生成和永久死亡为特点的游戏类型。本研究旨在将电商元素融入Rougelike游戏，尝试在游戏中加入真实商品商城。通过将真实商品与游戏机制相结合，玩家可以在游戏中使用游戏货币购买所需商品，提升用户粘性。同时，游戏内的推荐算法可以根据玩家的行为和偏好，提供个性化的商品推荐，进一步优化购物体验。通过将电商元素融入Roguelike游戏，本研究将为游戏行业开辟新的商业模式，推动游戏与电商的深度融合，为未来游戏开发和电商营销提供新的方向和思路。

### 1.2 国内外研究现状

汪旭晖等人（2023）发现游戏化的元素如积分、奖励、排行榜等能够显著提高用户的参与度和消费意愿。李宣（2023）指出游戏化可以有效地吸引用户并提高其参与度，但同时也需要注意避免过度游戏化带来的负面影响。李彤云等人（2024）发现通过游戏化的方式传递产品信息不仅能够吸引消费者的注意力，还能增强信息的记忆度和说服力。焦媛媛等人（2023）发现真实、透明的商品信息能够显著提高用户的信任度和忠诚度。杜松华等人（2022）探讨了游戏化如何驱动用户的绿色消费行为，强调了社会责任感在其中的作用。唐乐水和马缘园（2022）讨论了电商直播间的游戏中叙事技巧如何吸引观众并转化为购买行动。李建斌等人（2024）提出了一种能够根据用户情境和商品属性进行个性化推荐的方法。王茜和喻继军（2020）发现通过分析用户的历史购买行为，可以提高推荐的多样性和准确性。楚啸原和杨晓凡（2022）揭示了用户对虚拟商品的认知评价如何通过情感反应等中介变量间接影响其消费意愿。余文涛等人（2024）研究了平台经济环境下“平台-物流-商家”生态合作演化博弈，提出了一个模型来描述不同主体之间的互动关系。

MILANESI et al.（2023）强调了游戏化在提升用户体验和品牌忠诚度方面的作用。KUSUMAWARDANI et al.（2023）强调了游戏化、社交、享乐和实用价值在消费者决策中的重要性。KATARZYNA SZACHTA（2022）提出了游戏化在提高用户参与度和满意度方面的有效性。

### 1.3 主要创新

创新游戏商业模式。传统游戏主要依赖于虚拟商品销售或广告收入，真实商品融入游戏为游戏行业开辟了新的商业模式。这种模式不仅能够为游戏开发者带来额外的收入，还能为商家提供新的营销渠道。

推动游戏与电商的跨界融合。本研究尝试将游戏与电商两大领域结合，探索两者之间的协同效应。通过游戏化的方式促进商品销售，同时通过电商元素丰富游戏内容，推进游戏与电商的深度融合，为未来跨领域合作提供新的思路。

新技术的应用与实现。本研究使用虚幻5引擎开发Roguelike游戏，使用Ktor、Exposed和Kotlin Serialization等构建游戏商城服务器。

### 1.4 相关技术

虚幻5引擎（Unreal Engine，简称UE5）是由Epic Games开发的最新版游戏引擎，于2021年5月发布预览。UE5在图形渲染、物理模拟、动画系统、开发工具等方面进行了全面升级，使其成为目前最热门的3D游戏引擎。其核心特性包括Nanite虚拟化集合体、Lumen全局光照、虚拟阴影贴图（Virtual Shadow Maps）、MetaHuman Creator、World Partition、动画系统改进。UE5支持使用蓝图开发游戏，能极大降低上手门槛并提升开发效率，这也是本研究选用UE5的一大原因。

Ktor是由JetBrains开发的跨平台的轻量级异步 Kotlin 框架，可用于构建Web应用程序、HTTP服务和微服务。Ktor充分利用了Kotlin语言特性和协程（Coroutines），提供了高性能、可扩展的异步编程模型。其核心特性包括轻量级与模块化、异步与非阻塞、路由系统、丰富的内置官方插件、跨平台支持、易于测试。依赖于逐步健全的Kotlin生态和Kotlin与Java的互操作性，Ktor已然成为一个构建现代化应用程序后端的不错之选。

Exposed是由JetBrains开发的轻量级Kotlin ORM（Object-Relational Mapping，对象关系映射）框架，用于实现Kotlin应用程序与关系数据库的交互。Exposed提供了一种简单的方式来操作数据库，并支持多种数据库类型，如MySQL、PostgreSQL、SQLite等。Exposed的核心特性包括类型安全、可扩展的SQL构建器、支持事务、支持批量操作、支持Lazy Loading、支持Join操作、支持自定义SQL语句等。

Kotlin Serialization是由JetBrains开发的Kotlin序列化库，用于序列化和反序列化Kotlin对象。Kotlin Serialization提供了一种简单的方式来将Kotlin对象转换为字节数组，并支持多种序列化格式，如JSON、CBOR、Protobuf等。Kotlin Serialization的核心特性包括可扩展的序列化格式支持、支持自定义序列化器、支持序列化与反序列化配置、支持序列化与反序列化扩展等。

## 2 游戏设计

### 2.1 游戏核心机制

Roguelike是以随机生成和永久死亡为特点的游戏类型，起源于1980年的游戏《Rogue》，因其独特的机制和深度的策略性，逐渐发展为一个独立的类别。在本研究设计的游戏中，玩家需要在一个随机生成的世界中探索，击杀怪物以提升自身能力，并获取相应的游戏点数。玩家的最终目标是找到逃生裂隙，最终安全出逃，获得点数。如果玩家在逃生途中不慎死亡，游戏会直接结束，并扣除玩家本局已获取的游戏点数。

游戏的画面风格参考了《歧路旅人》、《饥荒》等游戏，采用2D+3D，游戏中的所有生物采用2D精灵图，而游戏场景则使用3D模型。

### 2.2 经济系统

游戏点数作为游戏货币，可以作为玩家在某局游戏中的分数，也可以作为游戏内的货币，用于购买商品。游戏点数可以通过击杀怪物、收集资源、完成任务等获得。

游戏点数与真实货币的转换比例为1000:1。

### 2.3 游戏场景生成

PCG（Procedural Content Generation）是虚幻5引擎中新增的程序化内容生成框架，旨在帮助开发者高效地创建复杂且多样化的游戏内容。PCG框架通过自动化和程序化的方式生成游戏世界中的各种元素，如植被、建筑物、生物等。

本研究的游戏场景借助PCG框架，自动生成场景植被、建筑和AI生物等。玩家在每一次开始新游戏时，程序都会生成随机的种子用于场景生成。

PCG通过获取地形数据，对数据进行随机采样以生成元素。

### 2.4 生物设计

#### 2.4.1 生物类设计

为了简化开发流程，本研究中的生物都统一由一个蓝图类BP_Creature（生物，派生自PaperZDCharacter）派生而来，在BP_Creature下派生出BP_Animal（动物）和BP_Hunter（狩猎者，可对其他生物发起攻击），BP_Hunter下派生出BP_Character（玩家）和BP_Enemy（敌人）。

[//]: # (TODO: 画出派生关系)

在将2D纹理导入后，需要使用Pager2D对纹理做处理，提取出精灵图并组成对应动画的纸片图像序列。之后使用PaperZD插件创建精灵的动画源和动画蓝图。2D生物需要将精灵材质改为MaskedLitSpriteMaterial，并设置投射阴影。

因为所有生物皆为2D精灵图，其Z轴旋转只能有两个值：0或180°。生物移动时，需要根据X轴方向决定生物的Z轴旋转。

[//]: # (TODO: 截取该逻辑的蓝图)

#### 2.4.2 玩家输入

虚幻5引擎的增强输入系统（Enhanced Input System）是对传统输入系统的升级，旨在提供更令话、强大的玩家输入处理能力。该系统支持复杂的输入处理、运行时重新映射输入、以及多平台输入设备的无缝继承。

通过创建输入映射将键盘、鼠标输入操作映射到事件，将其绑定到玩家控制器上，并定义相应的输入操作事件，即可实现玩家输入操作。

[//]: # (TODO: 截取绑定的蓝图)

[//]: # (TODO: 玩家输入事件蓝图和说明)

#### 2.4.3 角色动画

角色动画需要借助PaperZD插件，通过创建动画源和动画蓝图，在动画蓝图中创建动画状态机，根据角色当前状态来播放动画。

#### 2.4.4 动物和敌人 AI

虚幻5引擎中的AI行为树（Behavior Tree）是一种用于实现游戏AI的强大工具。它通过树状结构来定义AI的行为逻辑，是的开发者能够以模块化和可视化的方式构建复杂AI行为逻辑。

在本研究中，动物和敌人都具备一个行为：当处于闲置状态时，每隔一段时间在出生地附近走动。

[//]: # (TODO: 添加截图)

此外，动物和敌人的蓝图都添加了一个PawnSensing组件，该组件会触发OnSeePawn事件。当玩家靠近时，动物会朝着远离玩家的方向跑；而敌人会朝着玩家的方向跑，并在可以攻击时攻击玩家。

[//]: # (TODO: 添加截图)

#### 2.4.5 攻击实现

虚幻5引擎的蓝图中提供了应用伤害和任意伤害事件。在播放攻击动画时，可以向角色前方执行按通道进行多球体碰撞，检测到可攻击对象时，调用应用伤害对可攻击对象造成伤害。对于被攻击方，则实现任意伤害事件，减少生命值并播放受伤动画。

### 2.5 用户界面

虚幻5引擎提供了强大的工具和框架来创建用户界面（User Interface，简称UI）。UMG是虚幻5中用于创建用户界面的主要工具，基于Slate框架构建，提供了可视化的UI设计器。其主要组件包括Widget Blueprint和Widget Components，可以用来组合复杂的用户界面。

[//]: # (TODO: 提供用户界面截图)

在设计UI时，应当将其拆分为多个小部件（Widget），便于复用和维护。要尽量避免在每帧中更新不必要的UI元素，使用缓存和延迟更新技术。确保UI交互逻辑直观易用，提供清晰的提示和反馈。

### 2.6 音效与视觉表现

虚幻5引擎支持在多种情景下播放音乐或音效，例如在UI创建时，可以调用PlaySound2D来播放背景音乐；鼠标悬停按钮时，可以触发相关事件并播放音效；角色播放动画时，可以定义播放音效的通知实现在动画时播放音效。通过为多种情景添加适当的音乐或音效，可以提升用户的使用体验。

[//]: # (TODO: 提供音效截图)

本研究参考了《歧路旅人》的游戏表现风格，采用2D+3D的形式呈现角色和游戏场景，同时使用多个2D特效补充角色动画过程中的单调表现，提升游玩乐趣。

[//]: # (TODO: 提供2D+3D截图)

## 3 后端设计

本研究的后端全都使用了Kotlin的框架。

在服务器构建上使用异步框架Ktor。Ktor充分利用了Kotlin的语言特性，避免了传统回调地狱（Callback Hell）问题，代码更简洁易读。此外，因为Kotlin是一门强类型语言，并且对null进行了优化，可以避免很多常见的错误。同时，Kotlin的跨平台特性也使得Ktor成为一个跨平台框架，易于移植和维护。Ktor基于异步非阻塞的I/O模型，能够高效处理高并发请求，减少线程开销。

在数据库连接上，使用了Exposed。Exposed是一个Kotlin的ORM框架，使用DSL（Domain Specific Language）风格，开发者不需要自己编写SQL语句，使得数据库操作更加简单易读。

### 3.1 数据库设计

本研究使用MySQL作为数据库。MySQL是一个关系型数据库管理系统，以其高性能、可靠性和易用性而闻名。MySQL支持多种操作系统，包括Windows、Linux、macOS等。

#### 3.1.1 实体与关系

- 用户
- 商品
- 订单

#### 3.3.2 字段设计

- 用户
- 商品
- 订单

### 3.2 安全与认证

#### 3.2.1 用户密码加密

通常，用户的密码在存储到数据库时不能以明文形式存储，必须进行哈希加密（不可逆加密）。Argon2是一种密码哈希函数，专为密码哈希和密钥派生而设计。它在2015年赢得了密码哈希竞赛（Password Hashing Competition），并被广泛认为是目前最安全的密码哈希算法之一。

本研究中借助了Argon2进行密码加密，在密码存入数据库前，对密码先进行加密处理。在登录时，只需要验证加密后的密码是否与数据库中存储的加密后的密码匹配，以确定用户身份。

#### 3.2.2 资源访问限制

JWT（JSON Web Token）是一种开放标准（RFC 7519），用于在网络应用间安全地传输信息。它通常用于身份验证和信息交换，特别是在分布式系统中。JWT由Header、Payload和Signature三部分组成，三者用“.”分隔。Header部分包含令牌的类型和使用的签名算法，Payload部分包含关于实体和其他数据的声明（claims），Signature部分包含将Header和Payload进行Base64Url编码和算法计算的签名，用于验证令牌的完整性和真实性。

### 3.3 商品网络爬虫

本研究的商品列表使用Ktor客户端发起网络请求，并使用Ksoup将请求结果HTML解析，获取商品信息并存储到数据类，最后存储到数据库中。

每次服务端返回商品列表时，都会先确定数据库中是否有数据，若没有才向其他服务器爬取，减少对其他网站的请求次数。

### 3.4 推荐算法

本研究中设计了一个比较简单的推荐算法：基于玩家当前游戏点数数量和历史购买记录进行推荐，并随机推荐一些内容，将两者按照一定权重进行混合。

### 3.5 订单

因为订单系统的设计比较复杂，还需要接入各种第三方支付平台，本研究简化了订单，玩家在购买商品时，这件商品会直接加入到用户已购买的商品列表中。

## 4 总结与展望

### 4.1 研究成果总结

创新游戏商业模式。本研究通过在游戏内添加可使用游戏货币购买的商品，提升了用户粘性，成功将真实商品融入Roguelike游戏中，开辟了游戏行业的新模式。

推动了游戏与电商的跨界融合。本研究探索了游戏与电商两大领域的协同效应，既丰富了游戏内容，又通过游戏化的方式促进商品销售。

新技术的应用与实现。本研究使用虚幻5引擎开发了具有高水准画面表现和精妙战斗设计的Roguelike游戏，实现了程序化内容生成（PCG）框架，自动生成多样化的游戏场景和生物。同时，采用Ktor、Exposed和Kotlin Serialization等技术构建了高效、可扩展的游戏商城服务器。

### 4.2 不足与改进方向

本研究只实现了使用游戏货币全量购买商品，没有实现部分商品采用游戏货币部分抵扣加真实货币购买的功能。这会导致游戏只有支出而没有收入，需要做进一步优化。

游戏的可玩性和丰富度尚存在不足。游戏存在生物群落比较单一、游戏道具不够丰富等问题，需要继续优化游戏体验。

### 4.3 未来研究方向

这是一个好开始，在不多的时间里我学习并开发游戏，同时融入商城前后端，制作了这样一个大体系的项目。未来我会继续丰富游戏内容，更新自己的美术资源，优化战斗体验。最终，我会将游戏部分剥离本研究，衍生为一个可以游玩的独立游戏。

## 参考文献

[1] 汪旭晖,刘熙桐,宋松.平台型电商游戏化营销策略对用户消费行为的影响[J].中国流通经济,2023,37(04):47-59.

[2] 李彤云,马军平,杨昊博,曹丽.产品信息的游戏化传播及说服效应研究[J].内江科技,2022,43(01):82-83+148.

[3] 李建斌,钱自顺,蔡学媛,戴宾.跨境电商下基于商品属性–情境的推荐算法[J].系统工程学报,2024,39(03):333-343+468.

[4] 王茜,喻继军.基于商品购买关系网络的多样性推荐[J].系统管理学报,2020,29(01):61-72.

[5] 楚啸原,杨晓凡,理原,雷雳.虚拟商品感知有用性与网络游戏消费意愿：有调节的中介模型[J].中国临床心理学杂志,2020,28(05):1013-1016.

[6] 李宣.移动营销中的游戏化及其规制研究——基于行为经济学的视角[J].四川师范大学学报(社会科学版),2023,50(06):98-107.

[7] 王治,江文婷.游戏化营销策略对消费者补偿性消费行为的影响[J].商业经济研究,2024,(14):47-51.

[8] 余文涛,张国阳,何毅,耿慧.平台经济环境下“平台-物流-商家”生态合作演化博弈研究[J].系统工程理论与实践,1-30.

[9] 焦媛媛,高雪,张丹.电商平台情境下顾客黏性构念开发及其形成机制研究[J].管理工程学报,2023,37(04):67-84.

[10] 杜松华,徐嘉泓,张德鹏,杨晓光.游戏化如何驱动电商用户绿色消费行为——基于蚂蚁森林的网络民族志研究[J].南开管理评论,2022,25(02):191-204.

[11] 张剑,罗君.“游戏化”视角下电商平台“拉人助力”玩法分析——以“超级星秀猫”为例[J].文化与传播,2021,10(04):87-91.

[12] 文露.手机电商时代APP游戏化特征对消费者持续使用意愿的影响研究[J].中国储运,2022,(02):86-87.

[13] 唐乐水,马缘园.心流理论下电商直播间的游戏化叙事[J].南京晓庄学院学报,2022,38(03):104-109.

[14] Milanesi M, Guercini S, Runfola A. Let's play! Gamification as a marketing tool to deliver a digital luxury experience[J]. Electronic Commerce Research, 2023, 23(4): 2135-2152.

[15] Kusumawardani KA, Widyanto HA, Tambunan JEG. The role of gamification, social, hedonic and utilitarian values on e-commerce adoption[J]. Spanish Journal of Marketing - ESIC, 2023, 27(2): 158-177.

[16] Szachta K. Gamification in marketing strategies on the example of the e-commerce market[J]. Zeszyty Naukowe PTE w Zielonej Górze, 2022, ½(16): 149-159.

## 致谢

流年似水，岁月如歌。一路上磕磕绊绊，笑语欢声，随文章落幕，学生生涯也终将告一段落。

感谢好友的督促和鼓励，陪我走完大学最后的时光。感谢导师的宝贵建议，让我能不断明确行文方向。